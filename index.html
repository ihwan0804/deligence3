<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>성실 레벨 업 프로젝트 — PWA (v9.5 LITE+SFX)</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/htm@3.1.1/dist/htm.umd.js"></script>
<style>
  .card{ border-radius:1rem; border:1px solid #e2e8f0; background:#fff; box-shadow:0 1px 2px rgba(0,0,0,.04); }
  .btn{ display:inline-flex; align-items:center; justify-content:center; padding:.5rem .75rem; border-radius:.75rem; border:1px solid #cbd5e1; background:#fff; }
  .btn-primary{ background:#0f172a; color:#fff; border-color:#0f172a }
  .input{ width:100%; border:1px solid #cbd5e1; border-radius:.75rem; padding:.5rem .75rem }
  .avatar{ width:96px; height:96px; border-radius:9999px; overflow:hidden; border:2px solid #cbd5e1; background:#f1f5f9; display:flex; align-items:center; justify-content:center }
  .avatar img{ width:100%; height:100%; object-fit:cover; image-rendering: pixelated }
</style>
</head>
<body class="p-4">
  <div id="root"></div>
  <script>
    if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw-v95.js');
  </script>
  <script>
    const html = htm.bind(React.createElement);
    const LS_KEY = 'dlu.v95.staticavatars';
    const def = {profile:{level:1,xp:0,nextLevelXp:100,avatarKind:'static',avatarKey:'port1'}, settings:{ sfx:true, sfxVolume:0.4 }};
    function App(){
      const [s,setS] = React.useState(()=>{ try{ return Object.assign(def, JSON.parse(localStorage.getItem(LS_KEY)||'{}')); }catch(e){ return def; } });
      React.useEffect(()=> localStorage.setItem(LS_KEY, JSON.stringify(s)), [s]);
      const avatarSrc = s.profile.avatarKind==='static' ? ('./avatars/' + (s.profile.avatarKey||'port1') + '.png') : (s.avatars && s.avatars[s.profile.avatarKey]);
      const click = React.useMemo(()=> new Audio('./click.wav'), []);
      const success = React.useMemo(()=> new Audio('./success.wav'), []);
      const fail = React.useMemo(()=> new Audio('./fail.wav'), []);
      React.useEffect(()=>{ [click,success,fail].forEach(a=> a.volume = (s.settings && s.settings.sfxVolume) || 0.4 ); }, [s.settings]);
      function play(name){ if(!(s.settings && s.settings.sfx)) return; ({click, success, fail}[name]?.play?.()); }
      return html`<div className="max-w-5xl mx-auto space-y-4">
        <h1 className="text-2xl font-bold">성실 레벨 업 프로젝트 (PWA v9.5 LITE+SFX)</h1>
        <div className="card p-4">
          <div className="flex items-center gap-3 mb-3">
            <div className="avatar">${avatarSrc ? html`<img src=${avatarSrc}/>` : html`<div>No Avatar</div>`}</div>
            <div className="text-sm text-slate-600">설정 → 아바타에서 선택/업로드</div>
          </div>
          <div className="grid grid-cols-2 gap-4">
            <div>
              <div className="text-sm font-semibold mb-2">레포 포함(정적)</div>
              <div className="grid grid-cols-5 gap-2">
                ${Array.from({length:30},(_,i)=>'port'+(i+1)).map(slot=> html`<div key=${slot} className="border rounded-xl p-2"><div className="avatar mx-auto"><img src=${'./avatars/'+slot+'.png'} onError=${e=> e.target.closest('div.border').style.display='none'}/></div><div className="mt-1 text-center"><button className="btn" onClick=${()=> { setS(p=>({...p, profile:{...p.profile, avatarKind:'static', avatarKey:slot}})); play('click'); }}>선택</button></div></div>`)}
              </div>
            </div>
            <div>
              <div className="text-sm font-semibold mb-2">내 컴퓨터에서 업로드</div>
              <div className="grid grid-cols-5 gap-2">
                ${Array.from({length:10},(_,i)=>'portUpload'+(i+1)).map(slot=> html`<div key=${slot} className="border rounded-xl p-2"><div className="avatar mx-auto">${s.avatars && s.avatars[slot] ? html`<img src=${s.avatars[slot]}/>` : html`<div className="text-xs text-slate-500">빈</div>`}</div><div className="mt-1 flex justify-center gap-1"><label className="btn cursor-pointer">업로드<input type="file" accept="image/*" className="hidden" onChange=${e=>{ const f=e.target.files&&e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=> { setS(p=>({...p, avatars:{...(p.avatars||{}), [slot]: String(r.result)}, profile:{...p.profile, avatarKind:'upload', avatarKey:slot}})); play('success'); }; r.readAsDataURL(f); }}/></label><button className="btn" disabled=${!(s.avatars && s.avatars[slot])} onClick=${()=> { setS(p=>({...p, profile:{...p.profile, avatarKind:'upload', avatarKey:slot}})); play('click'); }}>선택</button></div></div>`)}
              </div>
              <div className="mt-2 text-xs text-slate-500 flex items-center gap-2">
                <label className="inline-flex items-center gap-1"><input type="checkbox" checked=${!!(s.settings && s.settings.sfx)} onChange=${e=> setS(p=>({...p, settings:{...(p.settings||{}), sfx:e.target.checked}}))}/> 효과음</label>
                <input type="range" min="0" max="1" step="0.05" value=${(s.settings && s.settings.sfxVolume) || 0.4} onChange=${e=> setS(p=>({...p, settings:{...(p.settings||{}), sfxVolume:Number(e.target.value)}}))} />
              </div>
            </div>
          </div>
        </div>
      </div>`;
    }
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(html`<${App} />`);
  </script>
</body>
</html>